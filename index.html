<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no" />
  <!-- CSP: –¥–µ—Ä–∂–∏–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤–Ω—É—Ç—Ä–∏ –≤–µ–±–≤—å—é -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: blob:; img-src 'self' https: data: blob:; script-src 'self' https://unpkg.com 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src https:; frame-ancestors *; form-action 'self'; navigate-to 'self'">
  <title>Paradise ‚Äî Mini App</title>
  <meta name="description" content="–†–µ—Å—Ç–æ—Ä–∞–Ω ‚Äî —Ä–µ—Å—Ç–æ—Ä–∞–Ω –≤ –†–æ—Å—Å–∏–∏. –ú–µ–Ω—é, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–æ–≤–æ—Å—Ç–∏, –∞–∫—Ü–∏–∏ –∏ –≥–∞–ª–µ—Ä–µ—è –≤ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.">

  <!-- –í—Å–µ —Å—Å—ã–ª–∫–∏ ‚Äî –≤–Ω—É—Ç—Ä–∏ webview -->
  <base target="_self">

  <!-- VK Mini Apps bridge -->
  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
  <script>
    (function initVKBridgeEarly(){
      try {
        if (window.vkBridge && typeof vkBridge.send === 'function') {
          vkBridge.send('VKWebAppInit');
        } else {
          window.parent && window.parent.postMessage({ type:'VKWebAppInit' }, '*');
        }
      } catch (e) {}
    })();
  </script>

  <style>
    :root{
      --bg:#ffffff; --text:#0f0f0f; --muted:#6b7280; --card:#f7f7f8; --border:#e5e7eb; --primary:#111827;
      --brand:#1e7b3d; --beige:#e5c991; --shadow:0 8px 30px rgba(0,0,0,.06);
      --radius:14px; --safe-top: env(safe-area-inset-top, 0px);
    }
    html[data-theme="dark"]{
      --bg:#0b0b0c; --text:#f3f4f6; --muted:#9ca3af; --card:#141417; --border:#22242a; --primary:#f3f4f6;
      --shadow:0 8px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);color:var(--text);transition:background .25s,color .25s;
      -webkit-tap-highlight-color: transparent;
    }
    a{text-decoration:none;color:inherit}

    .page{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}

    /* ---------- HEADER ---------- */
    .header{
      position:sticky;top:0;z-index:5;background:var(--bg);
      padding:calc(8px + var(--safe-top)) 16px 8px;border-bottom:1px solid var(--border);
      display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px;
    }
    .actions-left{grid-column:1;justify-self:start;display:flex;align-items:center}
    .brand{
      grid-column:2;justify-self:center;
      display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.4px;font-size:18px;white-space:nowrap
    }
    .brand img{height:28px;display:block}
    .actions-right{grid-column:3;justify-self:end}

    #themeToggle{
      width:38px;height:38px;border-radius:999px;display:inline-grid;place-items:center;
      padding:0;border:1px solid var(--border);background:var(--card);box-shadow:var(--shadow);font-size:18px
    }

    .content{padding:18px 16px 28px;max-width:980px;margin:0 auto}
    .footer{padding:18px 16px;color:var(--muted);border-top:1px solid var(--border);text-align:center;background:var(--bg)}

    .btn{
      background:transparent;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 14px;
      display:inline-flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;transition:background .15s,border-color .15s,transform .12s
    }
    .btn:hover{background:var(--card)} .btn:active{transform:scale(.98)}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .section{margin-top:26px} .section h2{margin:0 0 10px;font-size:22px}
    .muted{color:var(--muted)}

    .grid{margin-top:22px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px;min-height:110px;transition:transform .16s,background .2s;box-shadow:var(--shadow)}
    .card:hover{transform:translateY(-2px)}
    input,select,textarea{background:var(--bg);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:14px;width:100%;outline:none}
    form{display:grid;gap:10px}
    .notice{margin-top:10px;font-size:13px;color:var(--muted);text-align:center}

    /* ---------- HERO SLIDER ---------- */
    .hero{margin-top:8px}
    .slider{position:relative;border-radius:var(--radius);overflow:hidden;background:var(--card);height:44vh;min-height:260px;max-height:520px;display:grid;place-items:center;box-shadow:var(--shadow)}
    .slides{position:absolute;inset:0;display:grid}
    .slide{grid-area:1/1;opacity:0;transform:scale(1.02);transition:opacity .5s,transform .6s;background:#000}
    .slide.active{opacity:1;transform:none}
    .slide img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.02)}
    .slider::after{content:"";position:absolute;inset:auto 0 0 0;height:34%;background:linear-gradient(to bottom,rgba(0,0,0,0),rgba(0,0,0,.35));pointer-events:none}
    .slider-nav{position:absolute;left:0;right:0;bottom:12px;display:flex;gap:6px;justify-content:center;z-index:2}
    .dot{width:8px;height:8px;border-radius:50%;border:1px solid rgba(255,255,255,.9);background:rgba(255,255,255,.25);cursor:pointer;transition:transform .15s,background .15s}
    .dot.active{background:#fff;transform:scale(1.2)}
    .hero-nav{margin:12px auto 0;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    .hero-note{margin-top:8px}

    /* ---------- Category cards (–∫–Ω–æ–ø–∫–∏) ---------- */
    .cat-card{
      appearance:none;-webkit-appearance:none;cursor:pointer;padding:0;width:100%;
      position:relative;overflow:hidden;border-radius:var(--radius);border:1px solid var(--border);
      background:var(--card);aspect-ratio:3/2;isolation:isolate;box-shadow:var(--shadow);
      touch-action: manipulation; -webkit-touch-callout: none;
    }
    /* –í–∞–∂–Ω–æ –¥–ª—è iOS: –≤–µ—Å—å —Ç–∞–ø –∏–¥—ë—Ç –≤ –∫–Ω–æ–ø–∫—É, –Ω–µ –≤ img/p */
    .cat-card * { pointer-events: none; user-select: none; -webkit-user-select: none; }
    .cat-card img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .35s}
    .cat-card::after{content:"";position:absolute;inset:0;background:linear-gradient(to top, rgba(0,0,0,.42), rgba(0,0,0,0) 55%);opacity:.9;mix-blend-mode:multiply}
    .cat-card:hover img{transform:scale(1.04)}
    .cat-meta{position:absolute;left:12px;right:12px;bottom:12px;z-index:1;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.25)}
    .cat-title{font-weight:700;font-size:16px;margin:0 0 2px}
    .cat-sub{margin:0;opacity:.9;font-size:13px}
    .cat-card.noimg{background:linear-gradient(140deg, color-mix(in oklab, var(--beige) 55%, transparent), var(--card));display:grid;place-items:end start;padding:12px}
    .cat-card.noimg .cat-title,.cat-card.noimg .cat-sub{color:var(--text);text-shadow:none}

    /* ---------- SHEET ---------- */
    .sheet{position:fixed;inset:0;background:var(--bg);z-index:50;opacity:0;transform:translateY(6%);pointer-events:none;transition:opacity .18s,transform .22s}
    .sheet.open{opacity:1;transform:translateY(0);pointer-events:auto}
    .sheet .bar{position:sticky;top:0;display:flex;align-items:center;gap:10px;padding:12px 16px;border-bottom:1px solid var(--border);background:var(--bg);z-index:2}
    .sheet .title{font-weight:700}
    .sheet .wrap{max-width:980px;margin:0 auto;padding:14px 16px 24px}
    .dish-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(min-width:720px){.dish-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .dish{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;background:var(--card);display:flex;flex-direction:column;box-shadow:var(--shadow)}
    .dish .pic{position:relative;aspect-ratio:4/3;background:var(--card)}
    .dish .pic img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.03)}
    .dish .pic.noimg{display:grid;place-items:center;background:linear-gradient(140deg, color-mix(in oklab, var(--beige) 55%, transparent), var(--card))}
    .dish .body{padding:10px 12px;display:grid;gap:6px}
    .dish .name{font-weight:700}
    .dish .row{display:flex;justify-content:space-between;align-items:center}
    .price{font-weight:700}

    /* ---------- NEWS / GALLERY / REVIEWS ---------- */
    .news{display:grid;gap:12px}
    .news-card{border:1px solid var(--border);background:var(--card);border-radius:var(--radius);padding:0;overflow:hidden;box-shadow:var(--shadow)}
    .news-img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block}
    .news-body{padding:14px}
    .news-head{display:flex;gap:8px;align-items:center;margin-bottom:6px}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:transparent}
    .news-date{font-size:12px;color:var(--muted)}
    .gallery{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
    @media(min-width:720px){.gallery{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .gallery img{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:12px;border:1px solid var(--border);cursor:pointer;box-shadow:var(--shadow)}
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:70}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw;max-height:88vh;border-radius:12px;box-shadow:0 20px 60px rgba(0,0,0,.5)}

    .reveal{opacity:0;transform:translateY(16px);transition:opacity .5s,transform .5s}
    .reveal.in{opacity:1;transform:none}
  </style>
</head>
<body>
  <div class="page">
    <header class="header">
      <div class="actions-left">
        <button id="themeToggle" class="btn" type="button" aria-label="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåì</button>
      </div>
      <div class="brand">
        <img src="logo-light.png" alt="" onerror="this.remove()">
        <span>–†–µ—Å—Ç–æ—Ä–∞–Ω</span>
      </div>
      <div class="actions-right"></div>
    </header>

    <main class="content">
      <!-- HERO with SLIDER -->
      <section class="hero reveal">
        <div class="slider" id="heroSlider" aria-roledescription="carousel">
          <div class="slides" id="slides"></div>
          <div class="slider-nav" id="dots"></div>
        </div>

        <div class="hero-nav">
          <a class="btn primary" href="#menu">–ú–µ–Ω—é</a>
          <a class="btn" href="#booking">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
          <a class="btn" href="#news">–ù–æ–≤–æ—Å—Ç–∏</a>
          <a class="btn" href="#gallery">–ì–∞–ª–µ—Ä–µ—è</a>
          <a class="btn" href="#promo">–ê–∫—Ü–∏–∏</a>
          <a class="btn" href="#contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </div>
        <div id="envNote" class="notice hero-note"></div>
      </section>

      <!-- –ú–µ–Ω—é -->
      <section id="menu" class="section reveal">
        <h2>–ú–µ–Ω—é</h2>
        <p class="muted">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:</p>
        <div id="catGrid" class="grid">
          <div class="card"><span class="muted">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π‚Ä¶</span></div>
        </div>
      </section>

      <!-- –ë—Ä–æ–Ω—å -->
      <section id="booking" class="section reveal">
        <h2>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
        <p class="muted">–≠—Ç–∞ —Ñ–æ—Ä–º–∞ –¥–µ–º–æ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç.</p>
        <form id="bookingForm">
          <input id="name" placeholder="–ò–º—è" required />
          <input id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, +7 999 000-00-00)" required />
          <input id="date" type="date" required />
          <input id="time" type="time" required />
          <select id="guests">
            <option>1 –≥–æ—Å—Ç—å</option><option>2 –≥–æ—Å—Ç—è</option><option>3 –≥–æ—Å—Ç—è</option>
            <option>4 –≥–æ—Å—Ç—è</option><option>5 –≥–æ—Å—Ç–µ–π</option><option>6 –≥–æ—Å—Ç–µ–π</option>
          </select>
          <textarea id="note" placeholder="–ü–æ–∂–µ–ª–∞–Ω–∏—è (—É –æ–∫–Ω–∞, —Ç–∏—Ö–∞—è –∑–æ–Ω–∞)‚Ä¶"></textarea>
          <button class="btn primary" type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å (–¥–µ–º–æ)</button>
          <div class="notice">–ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–∏–º –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞—è–≤–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –≤ VK.</div>
        </form>
      </section>

      <!-- –ù–æ–≤–æ—Å—Ç–∏ -->
      <section id="news" class="section reveal">
        <h2>–ù–æ–≤–æ—Å—Ç–∏</h2>
        <div class="news">
          <article class="news-card">
            <img class="news-img" src="news-1.webp" alt="" loading="lazy" onerror="this.remove()">
            <div class="news-body">
              <div class="news-head"><span class="badge">–ù–æ–≤–∏–Ω–∫–∞</span><span class="news-date">20.08</span></div>
              <h3 style="margin:0 0 6px">–ù–æ–≤—ã–π –∞–≤—Ç–æ—Ä—Å–∫–∏–π –¥–µ—Å–µ—Ä—Ç ¬´–†–µ—Å—Ç–æ—Ä–∞–Ω Gold¬ª</h3>
              <p class="muted">–ù–µ–∂–Ω–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞ –º–∞–Ω–≥–æ-–º—É—Å—Å–∞ —Å –≤–∞–Ω–∏–ª—å–Ω—ã–º –±–∏—Å–∫–≤–∏—Ç–æ–º. –î–æ—Å—Ç—É–ø–Ω–æ —Å —ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏.</p>
            </div>
          </article>
          <article class="news-card">
            <img class="news-img" src="news-2.webp" alt="" loading="lazy" onerror="this.remove()">
            <div class="news-body">
              <div class="news-head"><span class="badge">–°–æ–±—ã—Ç–∏–µ</span><span class="news-date">22.08</span></div>
              <h3 style="margin:0 0 6px">–ñ–∏–≤–∞—è –º—É–∑—ã–∫–∞ –≤ –ø—è—Ç–Ω–∏—Ü—É</h3>
              <p class="muted">–ê–∫—É—Å—Ç–∏—á–µ—Å–∫–∏–π –≤–µ—á–µ—Ä, –Ω–∞—á–∞–ª–æ –≤ 19:00. –ë—Ä–æ–Ω—å —Å—Ç–æ–ª–∏–∫–æ–≤ ‚Äî –≤–æ –≤–∫–ª–∞–¥–∫–µ ¬´–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ¬ª.</p>
            </div>
          </article>
        </div>
      </section>

      <!-- –ì–∞–ª–µ—Ä–µ—è -->
      <section id="gallery" class="section reveal">
        <h2>–ì–∞–ª–µ—Ä–µ—è</h2>
        <p class="muted">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞ –∏ –ø–æ–¥–∞—á–∏.</p>
        <div class="gallery" id="galleryGrid">
          <img src="gallery-1.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-2.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-3.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-4.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-5.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-6.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
        </div>
      </section>

      <!-- –ê–∫—Ü–∏–∏ -->
      <section id="promo" class="section reveal">
        <h2>–ê–∫—Ü–∏–∏</h2>
        <div class="grid">
          <div class="card">
            <img src="promo-1.webp" alt="" loading="lazy" onerror="this.remove()" style="width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;margin-bottom:10px">
            <strong>–°–µ—Ç ¬´–î—Ä—É–∑—å—è¬ª</strong><br><span class="muted">-20% –ø–æ –±—É–¥–Ω—è–º 12‚Äì16</span>
          </div>
          <div class="card">
            <img src="promo-2.webp" alt="" loading="lazy" onerror="this.remove()" style="width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;margin-bottom:10px">
            <strong>–ê–≤—Ç–æ—Ä—Å–∫–∏–π –¥–µ—Å–µ—Ä—Ç</strong><br><span class="muted">–≤ –ø–æ–¥–∞—Ä–æ–∫ –∫ –∫–æ—Ñ–µ–π–Ω–æ–º—É —Å–µ—Ç—É</span>
          </div>
        </div>
      </section>

      <!-- –û—Ç–∑—ã–≤—ã -->
      <section id="reviews" class="section reveal">
        <h2>–û—Ç–∑—ã–≤—ã</h2>
        <div class="reviews">
          <div class="review"><p class="who">–ú–∞—Ä–∏–Ω–∞</p><p class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</p><p class="muted">–û—á–µ–Ω—å —É—é—Ç–Ω–æ, –∫—É—Ö–Ω—è –Ω–∞ –≤—ã—Å–æ—Ç–µ. –û—Ñ–∏—Ü–∏–∞–Ω—Ç—ã –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–µ, –≤–µ—Ä–Ω—É—Å—å –µ—â—ë!</p></div>
          <div class="review"><p class="who">–ò–≥–æ—Ä—å</p><p class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</p><p class="muted">–ü–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –≥–æ—Ä—è—á–∏–µ –±–ª—é–¥–∞ –∏ –ø–æ–¥–∞—á–∞. –•–æ—Ä–æ—à–∞—è –≤–∏–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞.</p></div>
          <div class="review"><p class="who">–ê–ª–∏–Ω–∞</p><p class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</p><p class="muted">–î–µ—Å–µ—Ä—Ç—ã ‚Äî –æ–≥–æ–Ω—å! –ù–µ–º–Ω–æ–≥–æ –ª—é–¥–Ω–æ –≤ –ø—è—Ç–Ω–∏—Ü—É, –ª—É—á—à–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ.</p></div>
        </div>
      </section>

      <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
      <section id="contacts" class="section reveal">
        <h2>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
        <p><strong>–ê–¥—Ä–µ—Å:</strong> –†–æ—Å—Å–∏—è, –†–µ—Å—Ç–æ—Ä–∞–Ω</p>
        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <a href="tel:+79990000000">+7 (999) 000-00-00</a></p>
        <p><strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> 11:00‚Äì23:00</p>
        <div class="hero-nav" style="margin-top:10px">
          <a class="btn" href="#booking">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</a>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div style="display:flex;gap:10px;justify-content:center;margin-bottom:8px">
        <a class="btn" target="_blank" rel="noopener" href="https://vk.com/your_paradise_vk">VK</a>
      </div>
      ¬© <span id="year"></span> –†–µ—Å—Ç–æ—Ä–∞–Ω. –†–æ—Å—Å–∏—è.
    </footer>
  </div>

  <!-- –ü–ê–ù–ï–õ–¨ –ö–ê–¢–ï–ì–û–†–ò–ò -->
  <div id="sheet" class="sheet" aria-hidden="true">
    <div class="bar">
      <button id="backBtn" class="btn" type="button">‚Üê –ù–∞–∑–∞–¥</button>
      <div class="title" id="sheetTitle">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
    </div>
    <div class="wrap"><div id="dishGrid" class="dish-grid"></div></div>
  </div>

  <!-- –õ–ê–ô–¢–ë–û–ö–° -->
  <div id="lightbox" class="lightbox" aria-hidden="true"><img alt=""></div>

  <script>
  (function () {
    /* ====== API ====== */
    const API_URL   = "https://script.google.com/macros/s/AKfycbwxJjfKszBGQkXQm0BvAAXaxI3xGYNp597MHKTsVvjieWRI86vuIkHF5rSBkGkirJrp/exec";
    const API_TOKEN = "gonchar123";

    /* VK –æ–∫—Ä—É–∂–µ–Ω–∏–µ */
    const root = document.documentElement;
    const THEME_KEY = "paradise_theme";

    /* –¢–ï–ú–ê */
    function setTheme(theme) {
      root.setAttribute("data-theme", theme);
      localStorage.setItem(THEME_KEY, theme);
      try {
        const logo = document.querySelector('.brand img');
        if (logo) logo.src = theme === 'dark' ? 'logo-dark.png' : 'logo-light.png';
        document.getElementById('themeToggle').textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
      } catch (e) {}
    }
    const saved = localStorage.getItem(THEME_KEY);
    if (saved) setTheme(saved);
    else setTheme(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? "dark" : "light");
    document.getElementById("themeToggle")?.addEventListener("click", () => {
      const current = root.getAttribute("data-theme") || "light";
      setTheme(current === "light" ? "dark" : "light");
    });

    /* VK —Ç–µ–º–∞ */
    try {
      if (window.vkBridge && typeof vkBridge.subscribe === 'function') {
        vkBridge.subscribe((e) => {
          if (e?.detail?.type === 'VKWebAppUpdateConfig') {
            const scheme = e.detail.data?.scheme || '';
            if (scheme) setTheme(scheme.includes('dark') ? 'dark' : 'light');
          }
        });
        vkBridge.send('VKWebAppInit').catch(()=>{});
        document.addEventListener('DOMContentLoaded', ()=>vkBridge.send('VKWebAppInit').catch(()=>{}));
        window.addEventListener('load', ()=>vkBridge.send('VKWebAppInit').catch(()=>{}));
      } else {
        document.addEventListener('DOMContentLoaded', ()=>{
          try { window.parent && window.parent.postMessage({ type:'VKWebAppInit' }, '*'); } catch(e){}
        });
        window.addEventListener('load', ()=>{
          try { window.parent && window.parent.postMessage({ type:'VKWebAppInit' }, '*'); } catch(e){}
        });
      }
    } catch(e){}

    /* –ü–æ–¥–ø–∏—Å—å —Å—Ä–µ–¥—ã */
    const envNote = document.getElementById("envNote");
    function setEnvNote(text){ if(envNote) envNote.textContent = text; }
    setEnvNote("–û—Ç–∫—Ä—ã—Ç–æ –≤–æ VK Mini Apps (iOS)");

    /* REVEAL */
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if (e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target); }});
    },{threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    /* HERO SLIDER */
    const slideSrcs = Array.from({length:6},(_,i)=>`gallery-${i+1}.webp`);
    const slidesWrap = document.getElementById('slides');
    const dotsWrap = document.getElementById('dots');
    let slides = []; let dots = []; let idx = 0; let timer = null;
    const INTERVAL = 4500;
    function preload(src){ return new Promise(resolve=>{
      const img = new Image(); img.onload=()=>resolve(src); img.onerror=()=>resolve(null); img.src = src;
    });}
    Promise.all(slideSrcs.map(preload)).then(list=>{
      const valid = list.filter(Boolean);
      if (!valid.length){
        dotsWrap.style.display = 'none';
        slidesWrap.innerHTML = '<div class="slide active"><div style="display:grid;place-items:center;height:100%;color:#fff;background:#222">–î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª—ã gallery-1.webp ‚Ä¶ gallery-6.webp</div></div>';
        return;
      }
      valid.forEach((src, i)=>{
        const s = document.createElement('div');
        s.className = 'slide' + (i===0 ? ' active':'' );
        s.innerHTML = `<img src="${src}" alt="–†–µ—Å—Ç–æ—Ä–∞–Ω">`;
        slidesWrap.appendChild(s); slides.push(s);
        const d = document.createElement('button');
        d.className = 'dot' + (i===0 ? ' active':'' );
        d.setAttribute('aria-label', `–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–∞–π–¥—É ${i+1}`);
        d.addEventListener('click', ()=>go(i));
        dotsWrap.appendChild(d); dots.push(d);
      });
      start();
    });
    function setActive(i){ slides.forEach((s,k)=>s.classList.toggle('active', k===i));
      dots.forEach((d,k)=>d.classList.toggle('active', k===i)); }
    function go(to){ idx = (to + slides.length) % slides.length; setActive(idx); restart(); }
    function next(){ go(idx+1); }
    function start(){ stop(); timer = setInterval(next, INTERVAL); }
    function stop(){ if (timer) { clearInterval(timer); timer = null; } }
    function restart(){ stop(); start(); }
    const slider = document.getElementById('heroSlider');
    slider.addEventListener('mouseenter', stop);
    slider.addEventListener('mouseleave', start);
    let touchX = null;
    slider.addEventListener('touchstart', e=>{ touchX = e.touches[0].clientX; stop(); }, {passive:true});
    slider.addEventListener('touchend', e=>{
      if (touchX==null) return;
      const dx = e.changedTouches[0].clientX - touchX;
      if (Math.abs(dx) > 40) { dx<0 ? next() : go(idx-1); }
      touchX=null; start();
    });

    /* ====== –î–ï–§–û–õ–¢–ù–û–ï –ú–ï–ù–Æ ====== */
    let MENU = {
      salads: { key:'salads', title: "–°–∞–ª–∞—Ç—ã", sub:"–õ—ë–≥–∫–∏–µ –∏ —Å–≤–µ–∂–∏–µ", cat_image:"menu-salads.webp", items: [
        {id:"salad-greek",    name:"–ì—Ä–µ—á–µ—Å–∫–∏–π",         price:350, img:"salad-greek.webp"},
        {id:"salad-caesar",   name:"–¶–µ–∑–∞—Ä—å —Å –∫—É—Ä–∏—Ü–µ–π",  price:420, img:"salad-caesar.webp"},
        {id:"salad-olivier",  name:"–û–ª–∏–≤—å–µ",            price:320, img:"salad-olivier.webp"},
      ]},
      hot: { key:'hot', title: "–ì–æ—Ä—è—á–µ–µ", sub:"–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ —Ö–∏—Ç—ã", cat_image:"menu-hot.webp", items: [
        {id:"hot-steak",  name:"–°—Ç–µ–π–∫ –∏–∑ –≥–æ–≤—è–¥–∏–Ω—ã",     price:980, img:"hot-steak.webp"},
        {id:"hot-pasta",  name:"–ü–∞—Å—Ç–∞ –ö–∞—Ä–±–æ–Ω–∞—Ä–∞",       price:520, img:"hot-pasta.webp"},
        {id:"hot-salmon", name:"–õ–æ—Å–æ—Å—å –Ω–∞ –≥—Ä–∏–ª–µ",       price:890, img:"hot-salmon.webp"},
      ]},
      desserts: { key:'desserts', title: "–î–µ—Å–µ—Ä—Ç—ã", sub:"–ù–µ–∂–Ω—ã–µ —Å–ª–∞–¥–æ—Å—Ç–∏", cat_image:"menu-desserts.webp", items: [
        {id:"dessert-cheesecake", name:"–ß–∏–∑–∫–µ–π–∫ –ù—å—é-–ô–æ—Ä–∫", price:360, img:"dessert-cheesecake.webp"},
        {id:"dessert-tiramisu",   name:"–¢–∏—Ä–∞–º–∏—Å—É",         price:380, img:"dessert-tiramisu.webp"},
        {id:"dessert-macarons",   name:"–ú–∞–∫–∞—Ä–æ–Ω –∞—Å—Å–æ—Ä—Ç–∏",  price:340, img:"dessert-macarons.webp"},
      ]},
      drinks: { key:'drinks', title: "–ù–∞–ø–∏—Ç–∫–∏", sub:"–ö–ª–∞—Å—Å–∏–∫–∞ –∏ –∞–≤—Ç–æ—Ä—Å–∫–∏–µ", cat_image:"menu-drinks.webp", items: [
        {id:"drink-raf",       name:"–†–∞—Ñ –≤–∞–Ω–∏–ª—å–Ω—ã–π",      price:260, img:"drink-raf.webp"},
        {id:"drink-citrusade", name:"–¶–∏—Ç—Ä—É—Å–æ–≤—ã–π –ª–∏–º–æ–Ω–∞–¥",  price:240, img:"drink-citrusade.webp"},
        {id:"drink-mojito",    name:"–ú–æ—Ö–∏—Ç–æ –±/–∞",         price:250, img:"drink-mojito.webp"},
      ]}
    };

    const catGrid = document.getElementById('catGrid');

    /* –†–ï–ù–î–ï–† –∫–∞—Ç–µ–≥–æ—Ä–∏–π ‚Äî –∂—ë—Å—Ç–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ click+touchend */
    function renderCategories(menuObj){
      const cats = Object.entries(menuObj);
      if (!cats.length){
        catGrid.innerHTML = '<div class="card"><span class="muted">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</span></div>';
        return;
      }
      catGrid.innerHTML = '';
      cats.forEach(([key, cat])=>{
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'cat-card';
        btn.dataset.cat = key;
        btn.setAttribute('role','button');
        btn.setAttribute('tabindex','0');

        const imgSrc = (cat.cat_image || '').trim();
        const hasImg = !!imgSrc;
        btn.innerHTML = `
          ${hasImg ? `<img src="${imgSrc}" alt="${cat.title}" loading="lazy" draggable="false">` : ''}
          <div class="cat-meta">
            <p class="cat-title">${cat.title || key}</p>
            <p class="cat-sub">${cat.cat_sub || cat.sub || ''}</p>
          </div>
        `;

        if (!hasImg) {
          btn.classList.add('noimg');
        } else {
          btn.querySelector('img').onerror = function () {
            const card = this.closest('.cat-card'); if (card){ card.classList.add('noimg'); this.remove(); }
          };
        }

        const open = ()=> openSheet(key);

        btn.addEventListener('click', (ev)=>{ ev.preventDefault(); ev.stopPropagation(); open(); }, { passive:false });
        btn.addEventListener('touchend', (ev)=>{ ev.preventDefault(); ev.stopPropagation(); open(); }, { passive:false });
        btn.addEventListener('keydown', (ev)=>{ if (ev.key==='Enter' || ev.key===' ') { ev.preventDefault(); open(); }});

        catGrid.appendChild(btn);
      });
    }

    /* ===== –ü–ê–ù–ï–õ–¨ –ö–ê–¢–ï–ì–û–†–ò–ò ===== */
    const sheet = document.getElementById('sheet');
    const sheetTitle = document.getElementById('sheetTitle');
    const dishGrid = document.getElementById('dishGrid');
    document.getElementById('backBtn').addEventListener('click', closeSheet);

    function openSheet(catKey) {
      const cat = MENU[catKey];
      if (!cat) return;

      sheetTitle.textContent = cat.title || catKey;
      dishGrid.innerHTML = "";

      (cat.items || []).forEach(item => {
        const card = document.createElement('div');
        card.className = 'dish';
        card.innerHTML = `
          <div class="pic"><img src="${item.img || ''}" alt="${item.name}" loading="lazy" draggable="false"></div>
          <div class="body">
            <div class="name">${item.name}</div>
            <div class="row"><div class="price">${item.price} ‚ÇΩ</div></div>
            ${item.desc ? `<div class="muted">${item.desc}</div>` : ''}
          </div>
        `;
        const img = card.querySelector('img');
        img.onerror = () => { const pic=card.querySelector('.pic'); pic.classList.add('noimg'); pic.innerHTML='<span class="muted">–§–æ—Ç–æ —Å–∫–æ—Ä–æ</span>'; };
        dishGrid.appendChild(card);
      });

      sheet.classList.add('open');
      sheet.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
    }
    function closeSheet(){
      sheet.classList.remove('open');
      sheet.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }

    /* –£–±—Ä–∞–ª–∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤ –ø–æ catGrid (–º–µ—à–∞–µ—Ç iOS) */
    // catGrid.addEventListener('click', ... );

    /* –õ–ê–ô–¢–ë–û–ö–° */
    const lightbox = document.getElementById('lightbox');
    const lbImg = lightbox.querySelector('img');
    document.getElementById('galleryGrid')?.addEventListener('click', (e)=>{
      if (e.target.tagName !== 'IMG') return;
      e.preventDefault();
      lbImg.src = e.target.src;
      lightbox.classList.add('open');
      lightbox.setAttribute('aria-hidden','false');
    }, { passive:false });
    lightbox.addEventListener('click', ()=> {
      lightbox.classList.remove('open');
      lightbox.setAttribute('aria-hidden','true');
      lbImg.src = '';
    });

    /* –í–ê–õ–ò–î–ê–¶–ò–Ø –ë–†–û–ù–ò */
    document.getElementById('bookingForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const phone = document.getElementById('phone').value.trim();
      const name  = document.getElementById('name').value.trim();
      const date  = document.getElementById('date').value;
      const time  = document.getElementById('time').value;

      const clean = phone.replace(/[^\d+]/g,'');
      const ok = /^(\+7|7|8)?\d{10}$/.test(clean);
      if (!ok){ alert('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞'); return; }
      if (!name || !date || !time){ alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è'); return; }

      alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ (–¥–µ–º–æ). –ü–æ—Å–ª–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–¥–∫–ª—é—á–∏–º –æ—Ç–ø—Ä–∞–≤–∫—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –≤ VK.');
      e.target.reset();
    });

    /* –ó–∞–≥—Ä—É–∑–∫–∞ –ú–ï–ù–Æ */
    async function loadMenuFromSheet() {
      try {
        setEnvNote('–ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–Ω—é‚Ä¶');
        const url = `${API_URL}?sheet=menu&token=${encodeURIComponent(API_TOKEN)}&_=${Date.now()}`;
        const res = await fetch(url, { method: 'GET', cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);

        const data = await res.json(); // { menu, updated } –∏–ª–∏ { error }
        if (data && data.menu) {
          MENU = data.menu;
          renderCategories(MENU);
          setEnvNote('–û—Ç–∫—Ä—ã—Ç–æ –≤–æ VK Mini Apps (iOS)');
          console.log('–û—Ç–≤–µ—Ç API –æ–∫, –º–µ–Ω—é:', data);
        } else {
          console.warn('–û—Ç–≤–µ—Ç API –±–µ–∑ –º–µ–Ω—é:', data);
          setEnvNote('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–Ω—é ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é');
          renderCategories(MENU);
        }
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–µ–Ω—é:', err);
        setEnvNote('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é');
        renderCategories(MENU);
      }
    }
    renderCategories(MENU);
    loadMenuFromSheet();

    /* ===== HARD FIX: iOS VK tap interceptor (capture) =====
       –ù–∞ —Ñ–∞–∑–µ –∑–∞—Ö–≤–∞—Ç–∞ –±–ª–æ–∫–∏—Ä—É–µ–º –ª—é–±—ã–µ –∫–ª–∏–∫–∏/—Ç–∞—á–∏ –∏–∑ .cat-card,
       —á—Ç–æ–±—ã VK-–≤–µ–±–≤—å—é –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–ª –∏—Ö –≤ —Å–≤–æ–π –±—Ä–∞—É–∑–µ—Ä. */
    let tapLock = false; // –∞–Ω—Ç–∏ –¥–∞–±–ª-—Ç–∞–ø (click –ø–æ—Å–ª–µ touchend)
    function closestCatCard(el){ return el && el.closest ? el.closest('.cat-card') : null; }

    document.addEventListener('touchstart', (e)=>{
      const card = closestCatCard(e.target);
      if (!card) return;
      // –ë–ª–æ–∫–∏—Ä—É–µ–º –∂–µ—Å—Ç—ã –µ—â—ë –¥–æ VK
      e.preventDefault(); e.stopPropagation();
    }, { capture:true, passive:false });

    document.addEventListener('touchend', (e)=>{
      const card = closestCatCard(e.target);
      if (!card) return;
      e.preventDefault(); e.stopPropagation();
      const key = card.getAttribute('data-cat');
      if (key){ tapLock = true; openSheet(key); setTimeout(()=>tapLock=false, 350); }
    }, { capture:true, passive:false });

    document.addEventListener('click', (e)=>{
      const card = closestCatCard(e.target);
      if (!card) return;
      // –µ—Å–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ touchend ‚Äî —Å—ä–µ–¥–∞–µ–º click
      if (tapLock){ e.preventDefault(); e.stopPropagation(); return; }
      e.preventDefault(); e.stopPropagation();
      const key = card.getAttribute('data-cat');
      if (key) openSheet(key);
    }, { capture:true, passive:false });

    /* –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–ª–∏–∫-–≥–∞—Ä–¥ –ø–æ–¥ VK iOS –¥–ª—è <a> */
    document.addEventListener('click', (e)=>{
      const a = e.target.closest && e.target.closest('a[href]');
      if (!a) return;
      const href = a.getAttribute('href') || '';
      const isAnchor = href.startsWith('#');
      const isSafeProto = href.startsWith('tel:') || href.startsWith('mailto:');
      if (!isAnchor && !isSafeProto) {
        e.preventDefault(); e.stopPropagation();
        // –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ —è–≤–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –≤–Ω–µ—à–∫—É:
        // window.vkBridge?.send?.('VKWebAppOpenURL', { url: href }).catch(()=>{});
      }
    }, { capture:true, passive:false });

    document.getElementById("year").textContent = new Date().getFullYear();
    console.log("Mini App loaded. Env: VK iOS", { hasBridge: !!window.vkBridge });
  })();
  </script>
</body>
</html>

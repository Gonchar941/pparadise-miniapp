<!doctype html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Paradise — Mini App</title>
  <meta name="description" content="Ресторан — ресторан в России. Меню, бронирование, новости, акции и галерея в мини-приложении Telegram.">

  <!-- VK Mini Apps bridge (убирает вечную загрузку во VK-контейнере) -->
  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
  <script>
    // Инициируем максимально рано
    (function initVKBridgeEarly(){
      try {
        if (window.vkBridge && typeof vkBridge.send === 'function') {
          vkBridge.send('VKWebAppInit');
        } else {
          // фолбэк: сообщим родителю напрямую (на случай если библиотека не подгрузилась)
          window.parent && window.parent.postMessage({ type:'VKWebAppInit' }, '*');
        }
      } catch (e) {}
    })();
  </script>

  <style>
    :root {
      --bg:#ffffff; --text:#0f0f0f; --muted:#6b7280; --card:#f7f7f8; --border:#e5e7eb; --primary:#111827;
      --brand:#1e7b3d; --beige:#e5c991; --shadow:0 8px 30px rgba(0,0,0,.06);
      --radius:14px;
    }
    html[data-theme="dark"] {
      --bg:#0b0b0c; --text:#f3f4f6; --muted:#9ca3af; --card:#141417; --border:#22242a; --primary:#f3f4f6;
      --shadow:0 8px 30px rgba(0,0,0,.25);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg); color:var(--text);
      transition: background .25s ease, color .25s ease;
    }
    a{text-decoration:none;color:inherit}

    .page{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}

    .header{
      display:flex;justify-content:space-between;align-items:center;gap:10px;
      padding:12px 16px;border-bottom:1px solid var(--border);position:sticky;top:0;background:var(--bg);z-index:5
    }
    .brand{
      display:flex;align-items:center;gap:10px;font-weight:700;letter-spacing:.4px;font-size:18px;white-space:nowrap
    }
    .brand img{height:28px;display:block}
    .actions{display:flex;gap:8px;align-items:center}

    .content{padding:18px 16px 28px;max-width:980px;margin:0 auto}
    .footer{
      padding:18px 16px;color:var(--muted);border-top:1px solid var(--border);text-align:center;background:var(--bg)
    }

    .btn{
      background:transparent;color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 14px;
      display:inline-flex;align-items:center;gap:8px;cursor:pointer;font-size:14px;
      transition:background .15s ease,border-color .15s ease,transform .12s ease
    }
    .btn:hover{background:var(--card)}
    .btn:active{transform:scale(.98)}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .section{margin-top:26px}
    .section h2{margin:0 0 10px;font-size:22px}
    .muted{color:var(--muted)}

    .grid{margin-top:22px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(min-width:720px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:14px;min-height:110px;
      transition:transform .16s ease, background .2s ease; box-shadow:var(--shadow)
    }
    .card:hover{transform:translateY(-2px)}
    input,select,textarea{
      background:var(--bg);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:14px;width:100%;outline:none
    }
    form{display:grid;gap:10px}
    .notice{margin-top:10px;font-size:13px;color:var(--muted);text-align:center}

    /* ---------- HERO SLIDER ---------- */
    .hero{margin-top:8px}
    .slider{
      position:relative; border-radius:var(--radius); overflow:hidden; background:var(--card);
      height:44vh; min-height:260px; max-height:520px; display:grid; place-items:center; box-shadow:var(--shadow)
    }
    .slides{position:absolute; inset:0; display:grid}
    .slide{
      grid-area:1/1; opacity:0; transform:scale(1.02); transition:opacity .5s ease, transform .6s ease; background:#000
    }
    .slide.active{opacity:1; transform:none}
    .slide img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.02)}
    .slider::after{content:""; position:absolute; inset:auto 0 0 0; height:34%;
      background:linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,.35)); pointer-events:none}
    .slider-nav{position:absolute; left:0; right:0; bottom:12px; display:flex; gap:6px; justify-content:center; z-index:2}
    .dot{width:8px; height:8px; border-radius:50%; border:1px solid rgba(255,255,255,.9); background:rgba(255,255,255,.25);
      cursor:pointer; transition:transform .15s ease, background .15s ease}
    .dot.active{background:#fff; transform:scale(1.2)}

    .hero-nav{margin:12px auto 0;display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    .hero-note{margin-top:8px}

    /* ---------- Category cards ---------- */
    .cat-card{position:relative;overflow:hidden;border-radius:var(--radius);border:1px solid var(--border);background:var(--card);aspect-ratio:3/2;isolation:isolate; box-shadow:var(--shadow)}
    .cat-card img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .35s ease}
    .cat-card::after{content:"";position:absolute;inset:0;background:linear-gradient(to top, rgba(0,0,0,.42), rgba(0,0,0,0) 55%);opacity:.9;mix-blend-mode:multiply}
    .cat-card:hover img{transform:scale(1.04)}
    .cat-meta{position:absolute;left:12px;right:12px;bottom:12px;z-index:1;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.25)}
    .cat-title{font-weight:700;font-size:16px;margin:0 0 2px}
    .cat-sub{margin:0;opacity:.9;font-size:13px}
    .cat-card.noimg{background:linear-gradient(140deg, color-mix(in oklab, var(--beige) 55%, transparent), var(--card));display:grid;place-items:end start;padding:12px}
    .cat-card.noimg .cat-title,.cat-card.noimg .cat-sub{color:var(--text);text-shadow:none}

    /* ---------- SHEET (2-й уровень меню) ---------- */
    .sheet{position:fixed;inset:0;background:var(--bg);z-index:50;opacity:0;transform:translateY(6%);pointer-events:none;transition:opacity .18s ease,transform .22s ease}
    .sheet.open{opacity:1;transform:translateY(0);pointer-events:auto}
    .sheet .bar{position:sticky;top:0;display:flex;align-items:center;gap:10px;padding:12px 16px;border-bottom:1px solid var(--border);background:var(--bg);z-index:2}
    .sheet .title{font-weight:700}
    .sheet .wrap{max-width:980px;margin:0 auto;padding:14px 16px 24px}
    .dish-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(min-width:720px){.dish-grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .dish{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;background:var(--card);display:flex;flex-direction:column; box-shadow:var(--shadow)}
    .dish .pic{position:relative;aspect-ratio:4/3;background:var(--card)}
    .dish .pic img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.03)}
    .dish .pic.noimg{display:grid;place-items:center;background:linear-gradient(140deg, color-mix(in oklab, var(--beige) 55%, transparent), var(--card))}
    .dish .body{padding:10px 12px;display:grid;gap:6px}
    .dish .name{font-weight:700}
    .dish .row{display:flex;justify-content:space-between;align-items:center}
    .price{font-weight:700}

    /* ---------- NEWS ---------- */
    .news{display:grid;gap:12px}
    .news-card{border:1px solid var(--border);background:var(--card);border-radius:var(--radius);padding:0; overflow:hidden; box-shadow:var(--shadow)}
    .news-img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block}
    .news-body{padding:14px}
    .news-head{display:flex;gap:8px;align-items:center;margin-bottom:6px}
    .badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:transparent}
    .news-date{font-size:12px;color:var(--muted)}

    /* ---------- GALLERY + LIGHTBOX ---------- */
    .gallery{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
    @media(min-width:720px){.gallery{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .gallery img{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:12px;border:1px solid var(--border);cursor:pointer; box-shadow:var(--shadow)}
    .lightbox{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:70}
    .lightbox.open{display:flex}
    .lightbox img{max-width:92vw;max-height:88vh;border-radius:12px; box-shadow:0 20px 60px rgba(0,0,0,.5)}

    /* ---------- REVIEWS ---------- */
    .reviews{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:720px){.reviews{grid-template-columns:repeat(3,1fr)}}
    .review{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:14px; box-shadow:var(--shadow)}
    .review .who{font-weight:700;margin:0 0 4px}
    .stars{letter-spacing:1px}

    /* ---------- REVEAL ANIMATIONS ---------- */
    .reveal{opacity:0;transform:translateY(16px);transition:opacity .5s ease, transform .5s ease}
    .reveal.in{opacity:1;transform:none}
  </style>
</head>
<body>
  <div class="page">
    <header class="header">
      <div class="brand">
        <img src="logo-light.png" alt="" onerror="this.remove()">
        <span>Ресторан</span>
      </div>
      <div class="actions">
        <button id="themeToggle" class="btn" type="button">Тема</button>
      </div>
    </header>

    <main class="content">
      <!-- HERO with SLIDER -->
      <section class="hero reveal">
        <div class="slider" id="heroSlider" aria-roledescription="carousel">
          <div class="slides" id="slides"></div>
          <div class="slider-nav" id="dots"></div>
        </div>

        <div class="hero-nav">
          <a class="btn primary" href="#menu">Меню</a>
          <a class="btn" href="#booking">Бронирование</a>
          <a class="btn" href="#news">Новости</a>
          <a class="btn" href="#gallery">Галерея</a>
          <a class="btn" href="#promo">Акции</a>
          <a class="btn" href="#contacts">Контакты</a>
        </div>
        <div id="envNote" class="notice hero-note"></div>
      </section>

      <!-- Меню -->
      <section id="menu" class="section reveal">
        <h2>Меню</h2>
        <p class="muted">Выберите категорию:</p>
        <div class="grid">
          <a class="cat-card" data-cat="salads" href="javascript:void(0)">
            <img src="menu-salads.webp" alt="Салаты" onerror="this.closest('.cat-card').classList.add('noimg'); this.remove();" loading="lazy">
            <div class="cat-meta"><p class="cat-title">Салаты</p><p class="cat-sub">Лёгкие и свежие</p></div>
          </a>
          <a class="cat-card" data-cat="hot" href="javascript:void(0)">
            <img src="menu-hot.webp" alt="Горячее" onerror="this.closest('.cat-card').classList.add('noimg'); this.remove();" loading="lazy">
            <div class="cat-meta"><p class="cat-title">Горячее</p><p class="cat-sub">Классические хиты</p></div>
          </a>
          <a class="cat-card" data-cat="desserts" href="javascript:void(0)">
            <img src="menu-desserts.webp" alt="Десерты" onerror="this.closest('.cat-card').classList.add('noimg'); this.remove();" loading="lazy">
            <div class="cat-meta"><p class="cat-title">Десерты</p><p class="cat-sub">Нежные сладости</p></div>
          </a>
          <a class="cat-card" data-cat="drinks" href="javascript:void(0)">
            <img src="menu-drinks.webp" alt="Напитки" onerror="this.closest('.cat-card').classList.add('noimg'); this.remove();" loading="lazy">
            <div class="cat-meta"><p class="cat-title">Напитки</p><p class="cat-sub">Классика и авторские</p></div>
          </a>
        </div>
      </section>

      <!-- Бронь -->
      <section id="booking" class="section reveal">
        <h2>Бронирование</h2>
        <p class="muted">Эта форма демо — просто показывает, что страница работает.</p>
        <form id="bookingForm">
          <input id="name" placeholder="Имя" required />
          <input id="phone" placeholder="Телефон (например, +7 999 000-00-00)" required />
          <input id="date" type="date" required />
          <input id="time" type="time" required />
          <select id="guests">
            <option>1 гость</option><option>2 гостя</option><option>3 гостя</option>
            <option>4 гостя</option><option>5 гостей</option><option>6 гостей</option>
          </select>
          <textarea id="note" placeholder="Пожелания (у окна, тихая зона)…"></textarea>
          <button class="btn primary" type="submit">Отправить (демо)</button>
          <div class="notice">После утверждения подключим отправку заявки администратору в Telegram.</div>
        </form>
      </section>

      <!-- Новости -->
      <section id="news" class="section reveal">
        <h2>Новости</h2>
        <div class="news">
          <article class="news-card">
            <img class="news-img" src="news-1.webp" alt="" loading="lazy" onerror="this.remove()">
            <div class="news-body">
              <div class="news-head">
                <span class="badge">Новинка</span>
                <span class="news-date">20.08</span>
              </div>
              <h3 style="margin:0 0 6px">Новый авторский десерт «Ресторан Gold»</h3>
              <p class="muted">Нежная текстура манго-мусса с ванильным бисквитом. Доступно с этой недели.</p>
            </div>
          </article>
          <article class="news-card">
            <img class="news-img" src="news-2.webp" alt="" loading="lazy" onerror="this.remove()">
            <div class="news-body">
              <div class="news-head">
                <span class="badge">Событие</span>
                <span class="news-date">22.08</span>
              </div>
              <h3 style="margin:0 0 6px">Живая музыка в пятницу</h3>
              <p class="muted">Акустический вечер, начало в 19:00. Бронь столиков — во вкладке «Бронирование».</p>
            </div>
          </article>
        </div>
      </section>

      <!-- Галерея -->
      <section id="gallery" class="section reveal">
        <h2>Галерея</h2>
        <p class="muted">Фотографии интерьера и подачи.</p>
        <div class="gallery" id="galleryGrid">
          <img src="gallery-1.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-2.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-3.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-4.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-5.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
          <img src="gallery-6.webp" alt="Paradise" loading="lazy" onerror="this.remove()">
        </div>
      </section>

      <!-- Акции -->
      <section id="promo" class="section reveal">
        <h2>Акции</h2>
        <div class="grid">
          <div class="card">
            <img src="promo-1.webp" alt="" loading="lazy" onerror="this.remove()" style="width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;margin-bottom:10px">
            <strong>Сет «Друзья»</strong><br><span class="muted">-20% по будням 12–16</span>
          </div>
          <div class="card">
            <img src="promo-2.webp" alt="" loading="lazy" onerror="this.remove()" style="width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:10px;margin-bottom:10px">
            <strong>Авторский десерт</strong><br><span class="muted">в подарок к кофейному сету</span>
          </div>
        </div>
      </section>

      <!-- Отзывы -->
      <section id="reviews" class="section reveal">
        <h2>Отзывы</h2>
        <div class="reviews">
          <div class="review">
            <p class="who">Марина</p>
            <p class="stars">★★★★★</p>
            <p class="muted">Очень уютно, кухня на высоте. Официанты внимательные, вернусь ещё!</p>
          </div>
          <div class="review">
            <p class="who">Игорь</p>
            <p class="stars">★★★★★</p>
            <p class="muted">Понравились горячие блюда и подача. Хорошая винная карта.</p>
          </div>
          <div class="review">
            <p class="who">Алина</p>
            <p class="stars">★★★★☆</p>
            <p class="muted">Десерты — огонь! Немного людно в пятницу, лучше бронировать заранее.</p>
          </div>
        </div>
      </section>

      <!-- Контакты -->
      <section id="contacts" class="section reveal">
        <h2>Контакты</h2>
        <p><strong>Адрес:</strong> Россия, Ресторан</p>
        <p><strong>Телефон:</strong> <a href="tel:+79990000000">+7 (999) 000-00-00</a></p>
        <p><strong>Время работы:</strong> 11:00–23:00</p>
        <div class="hero-nav" style="margin-top:10px">
          <a class="btn" target="_blank" rel="noopener" href="https://yandex.ru/maps/?whatshere%5Bpoint%5D=37.802%2C48.002&whatshere%5Bzoom%5D=16">Открыть навигатор</a>
          <a class="btn primary" href="#booking">Забронировать</a>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div style="display:flex; gap:10px; justify-content:center; margin-bottom:8px">
        <a class="btn" target="_blank" rel="noopener" href="https://t.me/your_paradise_channel">Telegram</a>
        <a class="btn" target="_blank" rel="noopener" href="https://vk.com/your_paradise_vk">VK</a>
      </div>
      © <span id="year"></span> Ресторан. Россия.
    </footer>
  </div>

  <!-- ПАНЕЛЬ КАТЕГОРИИ -->
  <div id="sheet" class="sheet" aria-hidden="true">
    <div class="bar">
      <button id="backBtn" class="btn" type="button">← Назад</button>
      <div class="title" id="sheetTitle">Категория</div>
    </div>
    <div class="wrap">
      <div id="dishGrid" class="dish-grid"></div>
    </div>
  </div>

  <!-- ЛАЙТБОКС -->
  <div id="lightbox" class="lightbox" aria-hidden="true"><img alt=""></div>

  <script>
  (function () {
    const isTMA = /Telegram/i.test(navigator.userAgent);
    const isVK  = /(^|\.)vk\.(com|ru)/i.test(document.referrer);
    const root = document.documentElement;
    const THEME_KEY = "paradise_theme";

    /* ===== ТЕМА ===== */
    function setTheme(theme) {
      root.setAttribute("data-theme", theme);
      localStorage.setItem(THEME_KEY, theme);
      try {
        const logo = document.querySelector('.brand img');
        if (logo) logo.src = theme === 'dark' ? 'logo-dark.png' : 'logo-light.png';
      } catch (e) {}
    }
    const saved = localStorage.getItem(THEME_KEY);
    if (saved) setTheme(saved);
    else setTheme(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? "dark" : "light");
    document.getElementById("themeToggle")?.addEventListener("click", () => {
      const current = root.getAttribute("data-theme") || "light";
      setTheme(current === "light" ? "dark" : "light");
    });

    // Синхронизация темы из VK (если есть)
    try {
      if (window.vkBridge && typeof vkBridge.subscribe === 'function') {
        vkBridge.subscribe((e) => {
          if (e?.detail?.type === 'VKWebAppUpdateConfig') {
            const scheme = e.detail.data?.scheme || '';
            if (scheme) setTheme(scheme.includes('dark') ? 'dark' : 'light');
          }
        });
        // Повторные иниции на всякий случай
        vkBridge.send('VKWebAppInit').catch(()=>{});
        document.addEventListener('DOMContentLoaded', ()=>vkBridge.send('VKWebAppInit').catch(()=>{}));
        window.addEventListener('load', ()=>vkBridge.send('VKWebAppInit').catch(()=>{}));
      } else {
        // фолбэк — прямое сообщение родителю
        document.addEventListener('DOMContentLoaded', ()=>{
          try { window.parent && window.parent.postMessage({ type:'VKWebAppInit' }, '*'); } catch(e){}
        });
        window.addEventListener('load', ()=>{
          try { window.parent && window.parent.postMessage({ type:'VKWebAppInit' }, '*'); } catch(e){}
        });
      }
    } catch(e){}

    /* ===== Подпись среды ===== */
    const envNote = document.getElementById("envNote");
    try {
      envNote.textContent = isVK
        ? "Открыто во VK Mini Apps"
        : (isTMA ? "Открыто в Telegram WebView" : "Открыто в обычном браузере (это нормально)");
    } catch (e) {
      envNote.textContent = "Открыто в браузере";
    }

    /* ===== REVEAL анимации ===== */
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if (e.isIntersecting){ e.target.classList.add('in'); io.unobserve(e.target); }});
    },{threshold:.12});
    document.querySelectorAll('.reveal').forEach(el=>io.observe(el));

    /* ===== HERO SLIDER (gallery-1..6.webp) ===== */
    const slideSrcs = Array.from({length:6},(_,i)=>`gallery-${i+1}.webp`);
    const slidesWrap = document.getElementById('slides');
    const dotsWrap = document.getElementById('dots');
    let slides = []; let dots = []; let idx = 0; let timer = null;
    const INTERVAL = 4500;

    function preload(src){ return new Promise(resolve=>{
      const img = new Image();
      img.onload = ()=>resolve(src);
      img.onerror = ()=>resolve(null);
      img.src = src;
    });}

    Promise.all(slideSrcs.map(preload)).then(list=>{
      const valid = list.filter(Boolean);
      if (!valid.length){
        dotsWrap.style.display = 'none';
        slidesWrap.innerHTML = '<div class="slide active"><div style="display:grid;place-items:center;height:100%;color:#fff;background:#222">Добавьте файлы gallery-1.webp … gallery-6.webp</div></div>';
        return;
      }
      valid.forEach((src, i)=>{
        const s = document.createElement('div');
        s.className = 'slide' + (i===0 ? ' active':'');
        s.innerHTML = `<img src="${src}" alt="Ресторан">`;
        slidesWrap.appendChild(s);
        slides.push(s);

        const d = document.createElement('button');
        d.className = 'dot' + (i===0 ? ' active':'');
        d.setAttribute('aria-label', `Перейти к слайду ${i+1}`);
        d.addEventListener('click', ()=>go(i));
        dotsWrap.appendChild(d);
        dots.push(d);
      });
      start();
    });

    function setActive(i){
      slides.forEach((s,k)=>s.classList.toggle('active', k===i));
      dots.forEach((d,k)=>d.classList.toggle('active', k===i));
    }
    function go(to){
      idx = (to + slides.length) % slides.length;
      setActive(idx); restart();
    }
    function next(){ go(idx+1); }
    function start(){ stop(); timer = setInterval(next, INTERVAL); }
    function stop(){ if (timer) { clearInterval(timer); timer = null; } }
    function restart(){ stop(); start(); }

    const slider = document.getElementById('heroSlider');
    slider.addEventListener('mouseenter', stop);
    slider.addEventListener('mouseleave', start);
    let touchX = null;
    slider.addEventListener('touchstart', e=>{ touchX = e.touches[0].clientX; stop(); }, {passive:true});
    slider.addEventListener('touchend', e=>{
      if (touchX==null) return;
      const dx = e.changedTouches[0].clientX - touchX;
      if (Math.abs(dx) > 40) { dx<0 ? next() : go(idx-1); }
      touchX=null; start();
    });

    /* ===== ДАННЫЕ МЕНЮ ===== */
    const MENU = {
      salads: { title: "Салаты", items: [
        {id:"salad-greek",    name:"Греческий",         price:350, img:"salad-greek.webp"},
        {id:"salad-caesar",   name:"Цезарь с курицей",  price:420, img:"salad-caesar.webp"},
        {id:"salad-olivier",  name:"Оливье",            price:320, img:"salad-olivier.webp"},
      ]},
      hot: { title: "Горячее", items: [
        {id:"hot-steak",  name:"Стейк из говядины",     price:980, img:"hot-steak.webp"},
        {id:"hot-pasta",  name:"Паста Карбонара",       price:520, img:"hot-pasta.webp"},
        {id:"hot-salmon", name:"Лосось на гриле",       price:890, img:"hot-salmon.webp"},
      ]},
      desserts: { title: "Десерты", items: [
        {id:"dessert-cheesecake", name:"Чизкейк Нью-Йорк", price:360, img:"dessert-cheesecake.webp"},
        {id:"dessert-tiramisu",   name:"Тирамису",         price:380, img:"dessert-tiramisu.webp"},
        {id:"dessert-macarons",   name:"Макарон ассорти",  price:340, img:"dessert-macarons.webp"},
      ]},
      drinks: { title: "Напитки", items: [
        {id:"drink-raf",       name:"Раф ванильный",      price:260, img:"drink-raf.webp"},
        {id:"drink-citrusade", name:"Цитрусовый лимонад",  price:240, img:"drink-citrusade.webp"},
        {id:"drink-mojito",    name:"Мохито б/а",         price:250, img:"drink-mojito.webp"},
      ]}
    };

    /* ===== ПАНЕЛЬ КАТЕГОРИИ ===== */
    const sheet = document.getElementById('sheet');
    const sheetTitle = document.getElementById('sheetTitle');
    const dishGrid = document.getElementById('dishGrid');
    document.getElementById('backBtn').addEventListener('click', closeSheet);

    function openSheet(catKey){
      const cat = MENU[catKey]; if (!cat) return;
      sheetTitle.textContent = cat.title;
      dishGrid.innerHTML = "";
      cat.items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'dish';
        card.innerHTML = `
          <div class="pic"><img src="\${item.img}" alt="\${item.name}" loading="lazy"></div>
          <div class="body">
            <div class="name">\${item.name}</div>
            <div class="row"><div class="price">\${item.price} ₽</div></div>
          </div>`;
        const img = card.querySelector('img');
        img.onerror = () => { const pic=card.querySelector('.pic'); pic.classList.add('noimg'); pic.innerHTML='<span class="muted">Фото скоро</span>'; };
        dishGrid.appendChild(card);
      });
      sheet.classList.add('open');
      sheet.setAttribute('aria-hidden','false');
      document.body.style.overflow='hidden';
    }
    function closeSheet(){
      sheet.classList.remove('open');
      sheet.setAttribute('aria-hidden','true');
      document.body.style.overflow='';
    }
    document.querySelectorAll('.cat-card').forEach(a=>a.addEventListener('click', ()=> openSheet(a.dataset.cat)));

    /* ===== ЛАЙТБОКС ===== */
    const lightbox = document.getElementById('lightbox');
    const lbImg = lightbox.querySelector('img');
    document.getElementById('galleryGrid')?.addEventListener('click', (e)=>{
      if (e.target.tagName !== 'IMG') return;
      lbImg.src = e.target.src;
      lightbox.classList.add('open');
      lightbox.setAttribute('aria-hidden','false');
    });
    lightbox.addEventListener('click', ()=> {
      lightbox.classList.remove('open');
      lightbox.setAttribute('aria-hidden','true');
      lbImg.src = '';
    });

    /* ===== ВАЛИДАЦИЯ БРОНИ ===== */
    document.getElementById('bookingForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const phone = document.getElementById('phone').value.trim();
      const name  = document.getElementById('name').value.trim();
      const date  = document.getElementById('date').value;
      const time  = document.getElementById('time').value;

      const clean = phone.replace(/[^\d+]/g,'');
      const ok = /^(\+7|7|8)?\d{10}$/.test(clean);
      if (!ok){ alert('Проверьте номер телефона, пожалуйста'); return; }
      if (!name || !date || !time){ alert('Пожалуйста, заполните обязательные поля'); return; }

      alert('Заявка отправлена (демо). После утверждения подключим отправку администратору в Telegram.');
      e.target.reset();
    });

    /* ===== Прочее ===== */
    document.getElementById("year").textContent = new Date().getFullYear();
    console.log("Mini App loaded. Env:", { isVK, isTMA, hasBridge: !!window.vkBridge });
  })();
  </script>
</body>
</html>
